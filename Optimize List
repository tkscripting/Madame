(function() {
    'use strict';

    let isSwitchOn = false;

    function addIdToMuiBoxElements() {
        const parentElement = document.querySelector('.MuiPaper-root.MuiPaper-elevation.MuiPaper-rounded.MuiPaper-elevation2.css-1m9yl2a');
        if (parentElement) {
            const boxElements = parentElement.children;
            Array.from(boxElements).forEach((box) => {
                if (box.classList.contains('MuiBox-root') && box.classList.contains('css-0')) {
                    if (!box.id) {
                        box.id = 'VID';
                    }
                }
            });
        }
    }

    setTimeout(() => {
        addIdToMuiBoxElements();
    }, 2000);

    function createSwitch() {
        const switchWrapper = document.createElement('div');
        switchWrapper.style.display = 'inline-block';

        const switchLabel = document.createElement('label');
        switchLabel.style.position = 'relative';
        switchLabel.style.display = 'inline-block';
        switchLabel.style.width = '50px';
        switchLabel.style.height = '24px';
        switchLabel.style.cursor = 'pointer';
        switchLabel.style.borderRadius = '50px';
        switchLabel.style.backgroundColor = '#ccc';
        switchLabel.style.transition = 'background-color 0.3s ease';

        const switchInput = document.createElement('input');
        switchInput.type = 'checkbox';
        switchInput.style.opacity = '0';
        switchInput.style.width = '0';
        switchInput.style.height = '0';

        const switchCircle = document.createElement('span');
        switchCircle.style.position = 'absolute';
        switchCircle.style.top = '4px';
        switchCircle.style.left = '4px';
        switchCircle.style.width = '16px';
        switchCircle.style.height = '16px';
        switchCircle.style.borderRadius = '50%';
        switchCircle.style.backgroundColor = '#fff';
        switchCircle.style.transition = 'transform 0.3s ease';

        switchLabel.appendChild(switchInput);
        switchLabel.appendChild(switchCircle);
        switchWrapper.appendChild(switchLabel);

        const savedState = localStorage.getItem('switchState');
        if (savedState === 'on') {
            switchInput.checked = true;
            switchLabel.style.backgroundColor = '#4cd964';
            switchCircle.style.transform = 'translateX(26px)';
            hideElementsWithoutImages();
            changeTextContent();
            changePathColor();
            isSwitchOn = true;
        } else {
            switchInput.checked = false;
            switchLabel.style.backgroundColor = '#ccc';
            switchCircle.style.transform = 'translateX(0)';
            showElementsWithoutImages();
            resetTextContent();
            resetPathColor();
            isSwitchOn = false;
        }

        switchInput.addEventListener('change', function() {
            if (switchInput.checked) {
                switchLabel.style.backgroundColor = '#4cd964';
                switchCircle.style.transform = 'translateX(26px)';
                hideElementsWithoutImages();
                changeTextContent();
                changePathColor();
                localStorage.setItem('switchState', 'on');
                isSwitchOn = true;
            } else {
                switchLabel.style.backgroundColor = '#ccc';
                switchCircle.style.transform = 'translateX(0)';
                showElementsWithoutImages();
                resetTextContent();
                resetPathColor();
                localStorage.setItem('switchState', 'off');
                isSwitchOn = false;
            }
        });

        return switchWrapper;
    }

    function createText() {
        const textWrapper = document.createElement('span');
        textWrapper.style.marginLeft = '10px';
        textWrapper.style.fontSize = '1rem';
        textWrapper.style.fontWeight = 'normal';
        textWrapper.style.color = '#333';
        textWrapper.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"';
        textWrapper.innerText = 'Optimize List';

        return textWrapper;
    }

    function appendSwitchAndTextToTarget() {
        const targetElementSelector = '.MuiGrid-root.MuiGrid-item.css-bl06vm';
        const targetElement = document.querySelector(targetElementSelector);

        if (targetElement) {
            const switchElement = createSwitch();
            const textElement = createText();

            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.justifyContent = 'flex-start';
            container.style.width = 'auto';
            container.style.flexShrink = '0';

            container.appendChild(switchElement);
            container.appendChild(textElement);

            container.style.marginTop = '14px';
            container.style.marginLeft = '20px';

            targetElement.insertAdjacentElement('afterend', container);
        }
    }

    function limitWidthToViewport() {
        const boxElement = document.querySelector('.MuiBox-root.css-o744zt');
        if (boxElement) {
            boxElement.style.width = '100vw';
            boxElement.style.maxWidth = '100vw';
            boxElement.style.overflowX = 'hidden';
            boxElement.style.overflowY = 'auto';
        }
    }

    function hideElementsWithoutImages() {
        const parentContainers = document.querySelectorAll('.MuiBox-root.css-caosg6');
        parentContainers.forEach(parentContainer => {
            const hasImage = parentContainer.querySelector('img') !== null;
            const boxZero = parentContainer.closest('.MuiBox-root.css-0');

            if (!hasImage && boxZero) {
                boxZero.style.display = 'none';
            } else if (boxZero) {
                boxZero.style.display = '';
            }

            const childElements = parentContainer.querySelectorAll('.MuiBox-root.css-hfakad');
            childElements.forEach(element => {
                const hasImageInChild = element.querySelector('img') !== null;
                if (!hasImageInChild) {
                    element.style.display = 'none';
                }
            });
        });

        const gg4vpmContainers = document.querySelectorAll('.MuiBox-root.css-gg4vpm');
        gg4vpmContainers.forEach(container => {
            const childBoxZeroElements = container.querySelectorAll('.MuiBox-root.css-0');
            childBoxZeroElements.forEach(child => {
                child.style.display = 'none';
            });
        });

        const hboir5Containers = document.querySelectorAll('.MuiBox-root.css-hboir5');
        hboir5Containers.forEach(container => {
            const boxZeroInside = container.querySelectorAll('.MuiBox-root.css-0');
            boxZeroInside.forEach(boxZero => {
                boxZero.style.display = 'none';
            });
        });

        const box178ykluElements = document.querySelectorAll('.MuiBox-root.css-178yklu');
        box178ykluElements.forEach(element => {
            const parentContainer = element.parentElement;
            const parentWidth = parentContainer.offsetWidth;
            element.style.position = 'relative';
            element.style.left = '50%';
            element.style.transform = 'translateX(-50%)';
            element.style.width = '60%';
        });
    }

    function showElementsWithoutImages() {
        const parentContainers = document.querySelectorAll('.MuiBox-root.css-caosg6');
        parentContainers.forEach(parentContainer => {
            const childElements = parentContainer.querySelectorAll('.MuiBox-root.css-hfakad');
            childElements.forEach(element => {
                element.style.display = '';
            });
        });

        const box178ykluElements = document.querySelectorAll('.MuiBox-root.css-178yklu');
        box178ykluElements.forEach(element => {
            element.style.width = '100%';
        });

        const hboir5Containers = document.querySelectorAll('.MuiBox-root.css-hboir5');
        hboir5Containers.forEach(container => {
            const boxZeroInside = container.querySelectorAll('.MuiBox-root.css-0');
            boxZeroInside.forEach(boxZero => {
                boxZero.style.display = '';
            });
        });

        const boxZeroWithVid = document.querySelectorAll('.MuiBox-root.css-0#VID');
        boxZeroWithVid.forEach(element => {
            element.style.display = '';
        });
    }

    function changeTextContent() {
        const allChildElements = document.querySelectorAll('.MuiBox-root.css-hfakad');
        allChildElements.forEach(element => {
            const textContainer = element.querySelector('.MuiBox-root.css-b6m7zh');
            if (textContainer) {
                const text = textContainer.textContent.trim();

                switch (text) {
                    case "Front Still Life":
                        textContainer.textContent = "Index";
                        break;
                    case "Outfit 1":
                        textContainer.textContent = "OU";
                        break;
                    case "Front Model":
                        textContainer.textContent = "FR";
                        break;
                    case "Back Model":
                        textContainer.textContent = "BK";
                        break;
                    case "Outfit 2":
                        textContainer.textContent = "OU 2";
                        break;
                    case "Detail 1":
                        textContainer.textContent = "CU";
                        break;
                    case "Side Still Life":
                        textContainer.textContent = "E1";
                        break;
                    case "Detail 2":
                        textContainer.textContent = "E2";
                        break;
                    case "Detail 3":
                        textContainer.textContent = "E3";
                        break;
                    case "Extra 1":
                        textContainer.textContent = "E4";
                        break;
                    case "Extra 2":
                        textContainer.textContent = "E5";
                        break;
                }
            }
        });
    }

    function resetTextContent() {
        const allChildElements = document.querySelectorAll('.MuiBox-root.css-hfakad');
        allChildElements.forEach(element => {
            const textContainer = element.querySelector('.MuiBox-root.css-b6m7zh');
            if (textContainer) {
                const text = textContainer.textContent.trim();

                switch (text) {
                    case "Index":
                        textContainer.textContent = "Front Still Life";
                        break;
                    case "OU":
                        textContainer.textContent = "Outfit 1";
                        break;
                    case "FR":
                        textContainer.textContent = "Front Model";
                        break;
                    case "BK":
                        textContainer.textContent = "Back Model";
                        break;
                    case "OU 2":
                        textContainer.textContent = "Outfit 2";
                        break;
                    case "CU":
                        textContainer.textContent = "Detail 1";
                        break;
                    case "E1":
                        textContainer.textContent = "Side Still Life";
                        break;
                    case "E2":
                        textContainer.textContent = "Detail 2";
                        break;
                    case "E3":
                        textContainer.textContent = "Detail 3";
                        break;
                    case "E4":
                        textContainer.textContent = "Extra 1";
                        break;
                    case "E5":
                        textContainer.textContent = "Extra 2";
                        break;
                }
            }
        });
    }

    function changePathColor() {
        const paths = document.querySelectorAll('path[d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2"]');
        paths.forEach(path => {
            path.setAttribute('fill', 'rgb(243, 114, 16)');
        });
    }

    function resetPathColor() {
        const paths = document.querySelectorAll('path[d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2"]');
        paths.forEach(path => {
            path.setAttribute('fill', '');
        });
    }

    const observer = new MutationObserver((mutationsList, observer) => {
        appendSwitchAndTextToTarget();
        limitWidthToViewport();

        if (document.querySelector('.MuiGrid-root.MuiGrid-item.css-bl06vm')) {
            observer.disconnect();
        }
    });

    observer.observe(document.body, { childList: true, subtree: true });

    appendSwitchAndTextToTarget();

})();
