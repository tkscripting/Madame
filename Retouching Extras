(function() {
    'use strict';

    function addButtonsIfNeeded() {
        const box = document.querySelector('.MuiBox-root.css-snppej');
        if (box && !document.querySelector('.custom-button')) {
            const templaterButton = document.createElement('button');
            templaterButton.textContent = 'Templater';
            templaterButton.classList.add('custom-button');
            templaterButton.style.padding = '6px 16px';
            templaterButton.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
            templaterButton.style.fontWeight = '500';
            templaterButton.style.fontSize = '0.875rem';
            templaterButton.style.lineHeight = '1.75';
            templaterButton.style.textTransform = 'uppercase';
            templaterButton.style.borderRadius = '4px';
            templaterButton.style.border = 'none';
            templaterButton.style.cursor = 'pointer';
            templaterButton.style.backgroundColor = '#000';
            templaterButton.style.color = '#fff';
            templaterButton.style.boxShadow = 'none';
            templaterButton.style.height = '29px';
            templaterButton.style.minWidth = '64px';
            templaterButton.style.transition = 'background-color 0.3s ease';
            templaterButton.style.display = 'inline-flex';
            templaterButton.style.alignItems = 'center';
            templaterButton.style.justifyContent = 'center';
            templaterButton.style.textAlign = 'center';
            templaterButton.style.marginRight = '16px';
            box.insertBefore(templaterButton, box.firstChild);

            templaterButton.addEventListener('click', function() {
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://studiotools.dev.product.ext.net-a-porter.com/bookmarklets/Madame - Template Checker.js';
                document.getElementsByTagName('head')[0].appendChild(script);
            });
        }
    }

    function clickShootOnlyButton() {
        const shootOnlyButton = Array.from(document.querySelectorAll('.MuiButtonBase-root.MuiButton-root.MuiButton-text.MuiButton-textPrimary.MuiButton-sizeSmall.MuiButton-textSizeSmall.MuiButton-colorPrimary.css-rsh3zc'))
            .find(button => button.textContent.trim() === "Shoot Only");

        if (shootOnlyButton) {
            shootOnlyButton.click();
        }
    }

    function clickAssignSelectedButton() {
        const assignButton = Array.from(document.querySelectorAll('.MuiButtonBase-root.MuiButton-root.MuiButton-text.MuiButton-textPrimary.MuiButton-sizeSmall.MuiButton-textSizeSmall.MuiButton-colorPrimary.css-1i1a21c'))
            .find(button => button.textContent.trim() === "Assign selected");

        if (assignButton) {
            assignButton.click();
        }
    }

    function clickConfirmButtonAfterCheckboxes() {
        const confirmButton = document.querySelector('.MuiButtonBase-root.MuiButton-root.MuiButton-contained.MuiButton-containedPrimary.MuiButton-sizeSmall.MuiButton-containedSizeSmall.MuiButton-colorPrimary.css-nlb5uj');

        if (confirmButton) {
            confirmButton.click();
        }
    }

    function addButtonInsideMuiBox() {
        const parentElement = document.querySelector('.MuiBox-root.css-mlggcq');

        if (parentElement) {
            const element = parentElement.querySelector('.MuiBox-root.css-ni3ac');

            if (element) {
                if (!element.querySelector('.tampermonkey-btn')) {
                    const button = document.createElement('button');
                    button.textContent = 'Confirm All';
                    button.classList.add('tampermonkey-btn');
                    button.style.padding = '6px 16px';
                    button.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
                    button.style.fontWeight = '500';
                    button.style.fontSize = '0.875rem';
                    button.style.lineHeight = '1.75';
                    button.style.textTransform = 'uppercase';
                    button.style.borderRadius = '4px';
                    button.style.border = 'none';
                    button.style.cursor = 'pointer';
                    button.style.backgroundColor = '#007bff';
                    button.style.color = '#fff';
                    button.style.boxShadow = 'none';
                    button.style.height = '29px';
                    button.style.minWidth = '120px';
                    button.style.whiteSpace = 'nowrap';
                    button.style.textOverflow = 'ellipsis';
                    button.style.overflow = 'hidden';
                    button.style.width = 'auto';
                    button.style.display = 'inline-flex';
                    button.style.alignItems = 'center';
                    button.style.justifyContent = 'center';
                    button.style.textAlign = 'center';

                    button.addEventListener('click', () => {
                        selectAndCheckAllCheckboxesConfirmAll();
                        clickConfirmButtonAfterCheckboxes();
                    });

                    element.appendChild(button);
                }
            }
        }
    }

    const observer = new MutationObserver(() => {
        addButtonsIfNeeded();
        addButtonInsideMuiBox();
    });

    observer.observe(document.body, { childList: true, subtree: true });

    addButtonsIfNeeded();
    addButtonInsideMuiBox();

    let lastTabIndex = 0;
    function cycleThroughTabs(event) {
        if (event.key === 'Tab') {
            const tabButtons = document.querySelectorAll('.MuiTabs-flexContainer.css-k008qs button');

            if (tabButtons.length === 0) return;

            lastTabIndex = (lastTabIndex + 1) % tabButtons.length;

            tabButtons[lastTabIndex].click();

            event.preventDefault();
        }
    }

    window.addEventListener('keydown', cycleThroughTabs);

})();
